{"version":3,"sources":["im.gif","progr.gif","Stream.js","App.js","index.js"],"names":["module","exports","__webpack_require__","p","Stream","_this","this","console","log","imageNr","finished","paused","createImageLayer","img","Image","style","position","zIndex","left","onload","imageOnload","onclick","imageOnclick","src","webcam","div","insertBefore","firstChild","e","length","del","shift","parentNode","removeChild","push","_this2","react_default","a","createElement","height","ref","d","Component","decode","v","str","i","byteLength","yo","getUint8","String","fromCharCode","document","addEventListener","window","App","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","state","connected","recording","stream","videos","linkpre","options","filters","name","optionalServices","navigator","bluetooth","requestDevice","device","gatt","connect","getPrimaryService","primaryService","getCharacteristic","videoChar","readValue","then","setState","JSON","parse","catch","warn","message","toast","startNotifications","asdf","dw","target","value","obj","type","encoding","concat","toConsumableArray","stringify","err","error","_context","t0","startRec","Uint8Array","of","writeValue","_this3","map","objectSpread","date","DateTime","fromISO","reverse","sort","b","parseInt","split","className","onClick","begin","Fragment","startStream","stopRec","stopStream","src_Stream","image","progr","key","href","aria-label","aria-hidden","poster","replace","controls","react_toastify","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.0a91982f.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/im.13de04a2.gif\";","module.exports = __webpack_public_path__ + \"static/media/progr.dc665344.gif\";","import React, { Component } from 'react';\n\n\nclass Stream extends Component {\n\n    componentDidMount() {\n        console.log('yo')\n        var imageNr = 0; // Serial number of current image\n        var finished = []; // References to img objects which have finished downloading\n        this.paused = false;\n\n        const createImageLayer = () => {\n            var img = new Image();\n            img.style.position = \"absolute\";\n            img.style.zIndex = -1;\n            img.style.left=\"0\"\n            img.onload = imageOnload;\n            img.onclick = imageOnclick;\n            img.src = \"http://zeroc.local:9000/?action=snapshot&n=\" + (++imageNr);\n            var webcam = this.div\n            try {\n                webcam.insertBefore(img, webcam.firstChild);\n            } catch (e) {\n                \n            }\n        }\n\n        // Two layers are always present (except at the very beginning), to avoid flicker\n        function imageOnload() {\n            this.style.zIndex = imageNr; // Image finished, bring to front!\n            while (1 < finished.length) {\n                var del = finished.shift(); // Delete old image(s) from document\n                del.parentNode.removeChild(del);\n            }\n            finished.push(this);\n            if (!this.paused) createImageLayer();\n        }\n\n        function imageOnclick() { // Clicking on the image will pause the stream\n            this.paused = !this.paused;\n            if (!this.paused) createImageLayer();\n        }\n\n        createImageLayer()\n\n    }\n\n    componentDidUnMount() {\n        this.paused = true\n    }\n\n    render() {\n        return (\n            <div\n                style={{\n                    height:500\n                }}\n                ref={d => this.div = d}\n            ></div>\n        )\n    }\n}\n\nexport default Stream","import React, { Component } from 'react';\nimport './App.scss';\nimport 'bulma/css/bulma.css'\nimport image from './im.gif'\nimport progr from './progr.gif'\nimport { DateTime } from 'luxon'\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport Stream from \"./Stream\"\n\n/*\n *\n * This is the main component\n * \n */\n\ndocument.addEventListener(\"deviceready\", onDeviceReady, false);\nfunction onDeviceReady() {\n  // print('window: ', window)\n  console.log('device ready')\n  console.log('window: ', window);\n  // console.log(device.cordova);\n  // console.log('device.cordova: ', device.cordova);\n}\n\nfunction decode(v) {\n  let str = \"\"\n  for (var i = 0; i < v.byteLength; i++) {\n    const yo = v.getUint8(i)\n    str += String.fromCharCode(yo)\n  }\n  return str\n}\n\n\n\n\nclass App extends Component {\n  constructor() {\n    super()\n    this.state = {\n      connected: false,\n      recording: false,\n      stream: false,\n      videos: [\n        // {\n        //   name: \"1234.mp4\",\n        //   screenshot: \"1234.png\",\n        //   length: 123\n        // },\n        // {\n        //   name: \"1234.mp4\",\n        //   screenshot: \"1234.png\",\n        //   length: 123\n        // },\n        // {\n        //   name: \"1234.mp4\",\n        //   screenshot: \"1234.png\",\n        //   length: 123\n        // }\n      ]\n    }\n\n    this.linkpre = \"http://zeroc.local:3000/\"\n  }\n\n  componentDidMount() {\n    // var url = 'https://image.shutterstock.com/image-vector/600-vector-thin-line-mini-450w-787030678.jpg'; // file or remote URL. url can also be dataURL, but giving it a file path is much faster\n    // var album = 'MyAppName';\n    // window.url = url;\n    // window.cordova.plugins.saveToCameraRoll.saveImage(url, \"asdf\", function (cameraRollAssetId) {\n    //   console.log('cameraRollAssetId: ', cameraRollAssetId);\n\n    // }, function (err) {\n    //   console.log('err: ', err);\n\n    // });\n  }\n\n  async begin() {\n    const options = {\n      filters: [{ name: 'zeroc' }],\n      optionalServices: ['17283985-3729-0129-3487-120938478700']\n    }\n\n    try {\n      const device = await navigator.bluetooth.requestDevice(options)\n      console.log('device: ', device);\n      const gatt = await device.gatt.connect()\n      console.log('gatt: ', gatt);\n      const primaryService = await gatt.getPrimaryService(\"17283985-3729-0129-3487-120938478700\")\n      console.log('primaryService: ', primaryService);\n\n      const videoChar = await primaryService.getCharacteristic(\"17283985-3729-0129-3487-120938478701\")\n      console.log('videoChar: ', videoChar);\n      // const deviceChar = await primaryService.getCharacteristic(\"17283985-3729-0129-3487-120938478702\")\n      // console.log('deviceChar: ', deviceChar);\n      // const snapChar = await primaryService.getCharacteristic(\"17283985-3729-0129-3487-120938478703\")\n\n\n      const value = videoChar.readValue()\n        .then(v => {\n          console.log('v: ', v);\n          var str = decode(v);\n          console.log('str: ', str);\n          this.setState({\n            videos: JSON.parse(str)\n          })\n        })\n        .catch(e => {\n          console.warn(\"ERROR\", e, e.message)\n\n          toast(e.message)\n        })\n\n\n      await videoChar.startNotifications()\n      videoChar.addEventListener('characteristicvaluechanged', (asdf) => {\n        window.asdf = asdf\n        const dw = asdf.target.value\n        let str = \"\"\n        for (var i = 0; i < dw.byteLength; i++) {\n          const yo = dw.getUint8(i)\n          str += String.fromCharCode(yo)\n        }\n\n        const obj = JSON.parse(str)\n        console.log('obj: ', obj);\n        if (obj.type == \"streamstart\") {\n          this.setState({\n            stream: true\n          })\n        } else if (obj.type == \"streamstop\") {\n          this.setState({\n            stream: false,\n          })\n        } else if (obj.type == \"recfinish\") {\n          this.setState({\n            recording: false,\n            encoding: true,\n          })\n        } else if (obj.type == \"recstart\") {\n          this.setState({\n            recording: true\n          })\n        } else if (obj.type == \"videofinish\") {\n          this.setState({\n            recording: false,\n            encoding: false,\n            videos: [...this.state.videos, obj]\n          })\n        } else if (obj.type == \"error\") {\n          toast(JSON.stringify(obj.err))\n        }\n        console.log('str: ', str);\n      });\n\n\n      this.setState({\n        connected: true\n      })\n\n      this.videoChar = videoChar\n\n    } catch (error) {\n      console.error('error: ', error);\n      console.error('error message: ', error.message);\n    }\n  }\n\n  startRec() {\n    var startRec = Uint8Array.of(1);\n    return this.videoChar.writeValue(startRec);\n  }\n\n\n  stopRec() {\n    var v = Uint8Array.of(0);\n    return this.videoChar.writeValue(v);\n  }\n\n  startStream() {\n    var v = Uint8Array.of(2);\n    return this.videoChar.writeValue(v);\n  }\n\n  stopStream() {\n    var v = Uint8Array.of(3);\n    return this.videoChar.writeValue(v);\n  }\n\n  render() {\n    console.log('this.state.videos: ', this.state.videos);\n    let videos = this.state.videos.map(v => ({\n      ...v,\n      date: DateTime.fromISO(v.date)\n    }))\n    videos = videos.reverse()\n    videos = videos.sort((a, b) => parseInt(b.name.split(\".\")) - parseInt(a.name.split(\".\")))\n    return (\n      <div className=\"App\">\n        <section className=\"section\">\n          <div className=\"container\">\n            <p>\n              <h1 className=\"is-title is-large has-text-white\">ZEROC</h1>\n            </p>\n            {!this.state.connected &&\n\n              <a\n                onClick={() => {\n                  this.begin()\n                }}\n                className=\"button is-large is-fullwidth\">\n                connect\n              </a>\n            }\n\n\n            {this.state.connected &&\n              <>\n                {!this.state.stream &&\n                  <>\n                    <a\n                      onClick={() => {\n                        // this.begin()\n                        this.startStream()\n                      }}\n                      className=\"button is-large is-fullwidth\">\n                      start stream\n              </a>\n\n                    <a\n                      onClick={() => {\n                        this.startRec()\n                      }}\n                      className=\"button is-large is-fullwidth\">\n                      start!</a>\n                    <a\n                      onClick={() => {\n                        this.stopRec()\n                      }}\n                      className=\"button is-large is-fullwidth\">\n                      stop!</a>\n                  </>\n                }\n\n                {this.state.stream &&\n                  <>\n                    <a\n                      onClick={() => {\n                        this.stopStream()\n                      }}\n                      className=\"button is-large is-fullwidth\">\n                      Stop stream\n              </a>\n                    <Stream />\n                  </>\n                }\n              </>\n            }\n            {this.state.recording &&\n              <>\n                {/* <a\n                onClick={() => {\n                  this.begin()\n                }}\n              className=\"button is-large is-fullwidth\">Recording\n                </a> */}\n                <img src={image} />\n              </>\n            }\n\n            {this.state.encoding &&\n              <>\n                {/* <a\n                onClick={() => {\n                  this.begin()\n                }}\n              className=\"button is-large is-fullwidth\">Recording\n                </a> */}\n                <img src={progr} />\n              </>\n            }\n\n          </div>\n        </section>\n        {!this.state.encoding &&\n          <div className=\"container\">\n            {videos.map(v => (\n              // <div>\n              //   name: {v.name}\n              //   length: {v.length}\n              // </div>\n              <>\n                <div key={v.name} className=\"card\">\n                  <header className=\"card-header\">\n                    <p className=\"card-header-title\">\n                      {v.name}\n                    </p>\n                    <a href=\"#\" className=\"card-header-icon\" aria-label=\"more options\">\n                      <span className=\"icon\">\n                        <i className=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n                      </span>\n                    </a>\n                  </header>\n                  <div className=\"card-content\">\n                    <div className=\"content\">\n                      <video\n                        poster={this.linkpre + v.name.replace(\".mp4\", \".jpg\")}\n                        controls>\n                        <source src={this.linkpre + v.name} type=\"video/mp4\" />\n                        <br />\n                      </video>\n                    </div>\n                  </div>\n                  <footer className=\"card-footer\">\n                    <a href={this.linkpre + v.name} className=\"card-footer-item\">Download</a>\n                    <a href=\"#\" className=\"card-footer-item\">--</a>\n                    <a href=\"#\" className=\"card-footer-item\">--</a>\n                  </footer>\n                </div>\n                <br />\n              </>\n            ))}\n          </div>\n        }\n        <ToastContainer />\n      </div>\n\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n"],"sourceRoot":""}